<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      http-equiv="Cache-Control"
      content="no-store, no-cache, must-revalidate"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <title>–ê–≤—Ç–æ—ñ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –¢–µ—Ä–µ–º–∫–∏, –ì–æ–ª–æ—Å—ñ—î–≤–æ ‚Äì –£—Ä–æ–∫–∏ –≤–æ–¥—ñ–Ω–Ω—è –ê–ö–ü–ü</title>
    <meta
      name="description"
      content="–Ü–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω—ñ —É—Ä–æ–∫–∏ –≤–æ–¥—ñ–Ω–Ω—è –∑ –∞–≤—Ç–æ—ñ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–º —É –ö–∏—î–≤—ñ (–¢–µ—Ä–µ–º–∫–∏, –ì–æ–ª–æ—Å—ñ—î–≤–æ, –í–î–ù–ì). –ê–ö–ü–ü, –≥–Ω—É—á–∫–∏–π –≥—Ä–∞—Ñ—ñ–∫, –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–æ —ñ—Å–ø–∏—Ç—É. –ó–∞–ø–∏—Å–∞—Ç–∏—Å—è –æ–Ω–ª–∞–π–Ω."
    />
    <link rel="stylesheet" href="css/styles.css?v=1.65" />
    <link rel="icon" href="img/favicon.ico" type="image/x-icon" />
  </head>
  <body>
    <div id="scheduleContainer">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
  </body>
</html>
<script>
  async function loadSchedule(month, user) {
    // ‚öôÔ∏è URL —Ç–≤–æ–≥–æ VPS-–ø—Ä–æ–∫—Å—ñ
    const url = `https://holydrivers.com.ua/api/proxy.php?month=${encodeURIComponent(
      month
    )}&user=${encodeURIComponent(user)}`;

    try {
      const res = await fetch(url);
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const data = await res.json();
      renderSchedule(data);
    } catch (err) {
      document.getElementById(
        "scheduleContainer"
      ).innerHTML = `<div style="color:red;">–ü–æ–º–∏–ª–∫–∞: ${err.message}</div>`;
    }
  }

  function getCellClass(value) {
    if (!value) return "";
    const val = value.toString().toLowerCase();
    if (val === "–≤—ñ–ª—å–Ω–æ") return "free";
    if (val === "—ñ—Å–ø–∏—Ç") return "exam";
    return "";
  }

  function renderSchedule(data) {
    if (data.error) {
      document.getElementById(
        "scheduleContainer"
      ).innerHTML = `<div style="color:red;">${data.error}</div>`;
      return;
    }

    let html = `
        <div class="schedule">
          <div class="left">
            <table>
              <tbody>
                ${data.leftCol.map((v) => `<tr><td>${v}</td></tr>`).join("")}
              </tbody>
            </table>
          </div>
          <div class="right">
            <table>
              <tbody>
                ${data.rightCols
                  .map(
                    (row) =>
                      `<tr>${row
                        .map(
                          (cell) =>
                            `<td class="${getCellClass(cell)}">${cell}</td>`
                        )
                        .join("")}</tr>`
                  )
                  .join("")}
              </tbody>
            </table>
          </div>
        </div>
      `;

    document.getElementById("scheduleContainer").innerHTML = html;
  }

  // üöÄ –í–∏–∫–ª–∏–∫ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
  loadSchedule("–ñ–æ–≤—Ç–µ–Ω—å", "");
</script>
